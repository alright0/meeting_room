{% extends 'new_site/base.html' %}
{% load custom_filters %}

{% block title %}{{room.name}}. Подробности{% endblock %}
{% block content %}
<div class="rooms">
    <div class="schedule">
        <h1>{{room.name}}</h1>
        <p style="text-align: center;"><b>Мест: {{room.seats}}.
                {% if room.board %} C доской. {% endif %}
                {% if room.projector %} C проектором.{% endif %}
            </b></p>
        <input type="submit" class="book" value="показать бронирование" id="show_form_button" onclick="show_form()">
        <table class="site_table" id="book_table" hidden="true">
            <form action="" method="POST" class="book_the_room" id="ScheduleForm">
                {%csrf_token %}
                {{form.as_table}}
                <tr>
                    <td colspan='2'><button class="book" name="submit">Забронировать</button>
                </tr>
                </tr>
        </table>
        </form>
    </div>

    <div class="spacer"></div>
    <div class="schedule">
        <p><b>Расписание комнаты:</b></p>
        </p>
        {% if schedule %}
        <ul>
            {% for meeting in schedule %}
            <li><b>Начало:</b> {{meeting.start_time|date:"d.m.Y H:i"}} -
                <b>Конец:</b> {{meeting.end_time|date:"d.m.Y H:i"}}.
            </li>
            {% endfor %}
        </ul>
        {% else %}
        <p>Комната свободна!</p>
        {% endif %}
    </div>

</div>

<script>
    // скрипт задает начальные значения даты начала и конца встречи

    var start = _add_and_format_time_for_datetime_local(new Date(), 1)
    var end = _add_and_format_time_for_datetime_local(new Date(), 2)

    document.getElementById("id_start_time").value = start
    document.getElementById("id_end_time").value = end

    document.getElementById("id_start_time").addEventListener("change", start_time_changed)
    document.getElementById("id_end_time").addEventListener("change", end_time_changed)

</script>

<script>
    // скрывает и показывает форму создания встречи
    function show_form() {
        var elem = document.getElementById('book_table');
        var button = document.getElementById('show_form_button');

        if (elem.hidden) {
            button.value = "скрыть бронирование"
            elem.hidden = false
        } else {
            button.value = "показать бронирование"
            elem.hidden = true
        };
    }
</script>


{% endblock %}