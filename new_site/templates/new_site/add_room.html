{% extends 'new_site/base.html' %}
{% load custom_filters %}

{% block title %}{{title}}{% endblock %}
{% block content %}
<div>
    <form action="#" method="POST" class="book_the_room" id="ScheduleForm" novalidate>
        {%csrf_token %}
        <table>{{form.as_table}}</table>

        <button name="add" id="add_button">Создать</button>
    </form>
    <button name="delete" id="delete_button" onclick="delete_room()" disabled="true">Удалить</button>

</div>

<script>
    const csrftoken = document.getElementsByName('csrfmiddlewaretoken').item(0).value
    document.getElementById("id_new_name").addEventListener("change", eventHandler)

    // подстановка значений комнат в браузере
    function eventHandler(event) {
        var id = document.getElementById('id_new_name');
        var room = document.getElementById('id_name');
        var seats = document.getElementById('id_seats');
        var board = document.getElementById('id_board');
        var projector = document.getElementById('id_projector');
        var description = document.getElementById('id_description');

        if (id.value != 0) {
            document.getElementById('add_button').innerText = "Обновить"
            document.getElementById('delete_button').disabled = false
            $.ajax({
                type: 'post',
                headers: { "X-Requested-With": "XMLHttpRequest" },
                data: { "id": id.value, "csrfmiddlewaretoken": csrftoken },
                success: function (response) {
                    room.value = response.name
                    seats.value = response.seats
                    board.checked = response.board
                    projector.checked = response.projector
                    description.value = response.description
                    console.log(response);
                },
                error: { "response": "Запись не найдена!" }
            }
            )
        } else {
            document.getElementById('add_button').innerText = "Создать"
            document.getElementById('delete_button').disabled = true
            room.value = ''
            seats.value = 1
            board.checked = false
            projector.checked = false
            description.value = ''
        }
    }

    function delete_room() {

        var id = document.getElementById('id_new_name');
        if (id.value != 0) {
            $.ajax({
                type: 'delete',
                action: "#",
                beforeSend: function (xhr) {
                    xhr.setRequestHeader("X-CSRFToken", '{{ csrf_token }}');
                },
                data: id.value,
                dateType: "test",
                success: function (response) {

                    console.log(response);
                }
            })
        }
    }

</script>

{% endblock %}